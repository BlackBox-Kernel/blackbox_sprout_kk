--- block/scsi_ioctl.c
+++ block/scsi_ioctl.c
@@ -505,7 +505,7 @@
 
 	if (bytes && blk_rq_map_kern(q, rq, buffer, bytes, __GFP_WAIT)) {
 		err = DRIVER_ERROR << 24;
-		goto error;
+		goto out;
 	}
 
 	memset(sense, 0, sizeof(sense));
@@ -515,6 +515,7 @@
 
 	blk_execute_rq(q, disk, rq, 0);
 
+out:
 	err = rq->errors & 0xff;	/* only 8 bit SCSI status */
 	if (err) {
 		if (rq->sense_len && rq->sense) {
@@ -720,14 +721,11 @@
 		break;
 	}
 
-	if (capable(CAP_SYS_RAWIO))
-		return 0;
-
 	/* In particular, rule out all resets and host-specific ioctls.  */
 	printk_ratelimited(KERN_WARNING
 			   "%s: sending ioctl %x to a partition!\n", current->comm, cmd);
 
-	return -ENOIOCTLCMD;
+	return capable(CAP_SYS_RAWIO) ? 0 : -ENOIOCTLCMD;
 }
 EXPORT_SYMBOL(scsi_verify_blk_ioctl);
 
