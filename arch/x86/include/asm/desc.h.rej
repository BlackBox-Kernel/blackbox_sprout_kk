--- arch/x86/include/asm/desc.h
+++ arch/x86/include/asm/desc.h
@@ -250,8 +250,7 @@
 		gdt[GDT_ENTRY_TLS_MIN + i] = t->tls_array[i];
 }
 
-/* This intentionally ignores lm, since 32-bit apps don't have that field. */
-#define LDT_empty(info)					\
+#define _LDT_empty(info)				\
 	((info)->base_addr		== 0	&&	\
 	 (info)->limit			== 0	&&	\
 	 (info)->contents		== 0	&&	\
@@ -261,18 +260,11 @@
 	 (info)->seg_not_present	== 1	&&	\
 	 (info)->useable		== 0)
 
-/* Lots of programs expect an all-zero user_desc to mean "no segment at all". */
-static inline bool LDT_zero(const struct user_desc *info)
-{
-	return (info->base_addr		== 0 &&
-		info->limit		== 0 &&
-		info->contents		== 0 &&
-		info->read_exec_only	== 0 &&
-		info->seg_32bit		== 0 &&
-		info->limit_in_pages	== 0 &&
-		info->seg_not_present	== 0 &&
-		info->useable		== 0);
-}
+#ifdef CONFIG_X86_64
+#define LDT_empty(info) (_LDT_empty(info) && ((info)->lm == 0))
+#else
+#define LDT_empty(info) (_LDT_empty(info))
+#endif
 
 static inline void clear_LDT(void)
 {
